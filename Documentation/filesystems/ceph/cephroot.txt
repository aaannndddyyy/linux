Mounting the root filesystem via Ceph (cephroot)
===============================================

Written 2013 by Rob Taylor <rob.taylor@codethink.co.uk>

derived from nfsroot.txt:

Written 1996 by Gero Kuhlmann <gero@gkminix.han.de>
Updated 1997 by Martin Mares <mj@atrey.karlin.mff.cuni.cz>
Updated 2006 by Nico Schottelius <nico-kernel-nfsroot@schottelius.org>
Updated 2006 by Horms <horms@verge.net.au>



In order to use a diskless system, such as an X-terminal or printer server
for example, it is necessary for the root filesystem to be present on a
non-disk device. This may be an initramfs (see Documentation/filesystems/
ramfs-rootfs-initramfs.txt), a ramdisk (see Documentation/initrd.txt), a
filesystem mounted via NFS or a filesystem mounted via Ceph. The following 
text describes on how to use NFS for the root filesystem.

For the rest of this text 'client' means the diskless system, and 'server'
means the NFS server.




1.) Enabling cephroot capabilities
    -----------------------------

In order to use cephroot, CEPH_FS needs to be selected as
built-in during configuration. Once this has been selected, the cephroot
option will become available, which should also be selected.

In the networking options, kernel level autoconfiguration can be selected,
along with the types of autoconfiguration to support. Selecting all of
DHCP, BOOTP and RARP is safe.




2.) Kernel command line
    -------------------

When the kernel has been loaded by a boot loader (see below) it needs to be
told what root fs device to use. And in the case of nfsroot, where to find
both the server and the name of the directory on the server to mount as root.
This can be established using the following kernel command line parameters:


root=/dev/ceph

  This is necessary to enable the pseudo-Ceph-device. Note that it's not a
  real device but just a synonym to tell the kernel to use Ceph instead of
  a real device.


cephroot=<monaddr1>[,<monaddr2>,...]:/[<subdir>]

  If cephroot is not specified, it is expected that that a valid mount will be
found via DHCP option 17, Root Path [1]

  <monaddrX>    Monitor address. Each takes the form host[:port]. If the port
		is not specified, the Ceph default of 6789 is assumed.

  <subdir>	A subdirectory subdir may be specified if a subset of the file
		system is to be mounted

cephrootopts=<ceph-opts>

  <ceph-opts>	Standard Ceph options. All options are separated by commas.
		See Documentation/filesystems/ceph/ceph.txt for options and
		their defaults.

cephrootappendip=1
		If cephrootappendip is set, then the subdir path has
		'/A.B.C.D' appended to it, where A.B.C.D is the primary client IP.

ip=<client-ip>:<server-ip>:<gw-ip>:<netmask>:<hostname>:<device>:<autoconf>:
   <dns0-ip>:<dns1-ip>

  If the ip parameter is used with cephboot, then <server-ip> is disregarded. 


ddebug_query="module ceph"

  This parameter enables debugging messages to appear in the kernel
  log at boot time so that administrators can verify that the correct
  Ceph mount options, server address, and root path are passed to the
  Ceph client.

4.) References
    ----------

[1] http://tools.ietf.org/html/rfc2132

5.) Credits
    -------

  cephroot was derived from nfsroot by Rob Taylor <rob.taylor@codethink.co.uk>

  The nfsroot code in the kernel and the RARP support have been written
  by Gero Kuhlmann <gero@gkminix.han.de>.

  The rest of the IP layer autoconfiguration code has been written
  by Martin Mares <mj@atrey.karlin.mff.cuni.cz>.

  In order to write the initial version of nfsroot I would like to thank
  Jens-Uwe Mager <jum@anubis.han.de> for his help.


